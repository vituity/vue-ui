
import { dateFormat } from './filters/dateFormat'
import * as filters from './filters/filters'
// import VueIcons from './icons'
// import VTooltip from 'v-tooltip'
// import VueResize from 'vue-resize'
import Logger from './utils/logger'

// import 'focus-visible'

// import 'vue-resize/dist/vue-resize.css'
// import 'v-tooltip/dist/v-tooltip.css'

// Exported mixins
// export { default as CoupledChild } from './mixins/CoupledChild'
// export { default as CoupledParent } from './mixins/CoupledParent'
export { default as DisabledChild } from './mixins/DisabledChild'
// export { default as DisableScroll } from './mixins/DisableScroll'

// Exported utils
// export { generateHtmlIcon } from './icons'

// Require all the components that start with 'BaseXXX.vue'
const requireComponent = require.context('./components', true, /[a-z0-9]+\.(jsx|vue)$/i)

export function install(Vue, options = {}) {
  Vue.filter('date', (date, format, config = {}) => {
    return dateFormat(date, format, { ...options, ...config })
  })

  for (const k in filters) {
    Vue.filter(k, filters[k].bind(options))
  }
  Vue.use(Logger)

  // For each matching file name...
  requireComponent.keys().forEach(fileName => {
    const componentConfig = requireComponent(fileName)
    const componentName = fileName
      .substr(fileName.lastIndexOf('/') + 1)
      // Remove the file extension from the end
      .replace(/\.\w+$/, '')
    // Globally register the component
    Vue.component(componentName, componentConfig.default || componentConfig)
  })
}

const plugin = {
  install
}

export default plugin

// Auto-install
let GlobalVue = null
if (typeof window !== 'undefined') {
  GlobalVue = window.Vue
} else if (typeof global !== 'undefined') {
  GlobalVue = global.Vue
}
if (GlobalVue) {
  GlobalVue.use(plugin)
}
